---
import MainLayout from '../layouts/MainLayout.astro'
import EffectsList from '../components/ui/EffectsList.vue'
import { getCollection } from 'astro:content'

// 在构建时获取所有动效数据
const effects = await getCollection('effects')

// 调试信息
console.log('Fetched effects:', effects)
console.log('Effects length:', effects.length)

// 转换为组件需要的格式，使用 frontmatter 中的 id 字段
let effectsData = []
if (Array.isArray(effects) && effects.length > 0) {
  effectsData = effects.map(effect => {
    const { demoComponent, ...rest } = effect.data
    return {
      ...rest,
      id: effect.data.id
    }
  })
}

// 确保 safeEffectsData 总是一个数组
const safeEffectsData = Array.isArray(effectsData) ? effectsData : []

// 调试信息
console.log('safeEffectsData =', safeEffectsData)
console.log('safeEffectsData.length =', safeEffectsData.length)
console.log('JSON.stringify(safeEffectsData) =', JSON.stringify(safeEffectsData))
---

<MainLayout>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- 页面头部 -->
    <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center">
          <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
            CSS 动效博客
          </h1>
          <p class="text-xl text-gray-600 dark:text-gray-400 max-w-3xl mx-auto">
            探索精美的CSS动效作品，每一个都是独立的技术文章
          </p>
        </div>
      </div>
    </div>

    <!-- 动效列表 -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <!-- 直接将数据作为 props 传递，Astro 会自动序列化 -->
      <EffectsList :effects="safeEffectsData" client:load />
    </div>
  </div>
</MainLayout>